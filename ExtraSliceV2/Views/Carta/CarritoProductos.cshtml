@model List<Producto>
@{
    string Idsession = Context.Session.GetString("Usuario");
    List<int> idsProductos = Context.Session.GetObject<List<int>>("IdProductos");

    decimal total = 0;
    @if (Model != null)
    {
        foreach (Producto pro in Model)
        {
            total += pro.Precio;
        }
    }


}


@if (Context.Session.GetObject<List<int>>("IdProductos") == null)
{
    <h1>No hay productos</h1>
}
@if (Model != null)
{
@*    <table class="table table-info">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Precio</th>
                <th>Borrar</th>
                <th>Cantidad</th>


            </tr>
        </thead>
        <tbody>
            @foreach (Producto pro in Model)
            {
                <tr>
                    <td>@pro.Nombre_producto</td>
                    <td>@pro.Precio €</td>
                    
                    <td><a asp-controller="Carta" asp-action="CarritoProductos" asp-route-ideliminar="@pro.IdProducto">Borrar</a></td>
                    <td>
                        <div>
                            <button onclick="disminuirInput(@pro.IdProducto)" id="disminuir_@pro.IdProducto">-</button>
                            <input id="valor_@pro.IdProducto" value="0" />
                            <button onclick="aumentarInput(@pro.IdProducto)" id="incrementar_@pro.IdProducto">+</button>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>*@

    <form method="post">
        <input class="form-control" type="text" name="idcliente" value="@Idsession" />
        @foreach (Producto pro in Model)
        {

            <div class="mb-3">
                <label>@pro.Nombre_producto</label>
                <input class="form-control" type="text" name="idproducto" value="@pro.IdProducto">
            </div>
            <div class="mb-3">
                <input class="form-control" type="text" name="precio" value="@pro.Precio" />
            </div>
            <div class="mb-3">
                <button type="button" onclick="disminuirInput(@pro.IdProducto)" id="disminuir_@pro.IdProducto" value="@pro.Precio">-</button>
                <input class="form-control" id="valor_@pro.IdProducto" name="cantidad" value="1" />
                <button type="button" onclick="aumentarInput(@pro.IdProducto)" id="incrementar_@pro.IdProducto"  value="@pro.Precio">+</button>
            </div>


        }
        <button type="submit">Realizar Pedido</button>
    </form>


    <h1 id="total">@total</h1>
    <h2>ID Usuario session = @Idsession</h2>
}
@section Scripts{
    <script>
        //$(document).ready(function () {
        //    $(".BotonBorrar").click(function () {
        //        var idProd = $(this).val();
        //        console.log(idProd)
        //    $.get("/Carta/CarritoProductos", { ideliminar: idProd });
        //    window.location.reload();
        //    });
        //});
      var total = parseFloat("@total".replace(/,/g, "."));
        function aumentarInput(id) {
            var idBoton = event.target.id;
            var idInput = "valor_" + id;
            var valorPrecio = "incrementar_" + id;
            var input = document.getElementById(idInput);
            var precio = document.getElementById(valorPrecio).value;
            const idcaja = document.getElementById("total");

            if (input.value >= 5) {
                input.value = 5;
            } else {
                input.value++;
                total += parseFloat(precio.replace(/,/g, "."));
                console.log(total.toFixed(2));
                idcaja.innerText = total.toFixed(2);
            }
           

        }
        function disminuirInput(id) {
            var idBoton = event.target.id;
            var idInput = "valor_" + id;
            var valorPrecio = "disminuir_" + id;
            var input = document.getElementById(idInput);
            var precio = document.getElementById(valorPrecio).value;
            const idcaja = document.getElementById("total");
            
            if (input.value <= 0) {
                input.value = 0;
            } else {
                input.value--;
                total -= parseFloat(precio.replace(/,/g, "."));
                idcaja.innerText = total.toFixed(2);
            }


        }
    </script>
    }
